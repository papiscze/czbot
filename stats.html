<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CZbot - Status Bota</title>
    <link href="templatemo-nexus-style.css" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ==================================== */
        /* SPECIÁLNÍ STYLY PRO STATUS STRÁNKU */
        /* ==================================== */
        
        /* Zajištění místa pod navigací a základní padding */
        .status-section {
            padding-top: 150px; 
            padding-bottom: 80px;
            min-height: 100vh;
        }

        .status-container {
            max-width: 1000px;
            margin: auto;
            padding: 0 20px;
        }

        /* Sekce hlavičky, používá cyber-style */
        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 3rem;
            color: var(--color-primary, #64c8ff); /* Zajištění fallback barvy */
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(100, 200, 255, 0.5);
        }

        .section-subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }
        
        /* Box se statistikami a cogs (inspirováno původním stylem) */
        .stats-box {
            background-color: rgba(10, 10, 20, 0.7);
            border: 1px solid rgba(100, 200, 255, 0.1);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 30px;
            box-shadow: 0 0 15px rgba(100, 200, 255, 0.1);
        }

        /* Flex kontejner pro dvě sloupce (Statistiky a Cogs) */
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 2fr; /* Statistiky: 1 díl, Cogs: 2 díly */
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .status-grid {
                grid-template-columns: 1fr; /* Pod sebou na menších obrazovkách */
            }
        }
        
        .column-title {
            color: var(--color-secondary, #fff);
            font-size: 1.8rem;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(100, 200, 255, 0.1);
            margin-bottom: 20px;
        }

        /* Styl pro položky seznamu (List Items) */
        .status-list, .cogs-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .status-list li, .cogs-list li {
            display: flex;
            justify-content: space-between;
            background-color: rgba(100, 200, 255, 0.05); /* Lehké pozadí pro řádek */
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .status-list li:hover, .cogs-list li:hover {
            background-color: rgba(100, 200, 255, 0.1);
        }

        .label {
            font-weight: 600;
            color: #ddd;
        }

        .value {
            font-weight: 400;
            text-align: right;
        }

        /* Styly pro barvy statusů */
        .status-online, .status-ok { 
            color: #48bb78; /* Zelená */
            font-weight: bold;
        }
        .status-offline, .status-err { 
            color: #f56565; /* Červená */
            font-weight: bold;
        }
        .status-offline-cog { 
            color: #f56565; /* Červená */
            font-weight: bold;
        }

        /* Varovný box */
        .warn-box {
            background: #dd6b20; /* oranžová */
            color: #fff;
            padding: 14px 18px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border: 2px solid #ff914d;
        }

        /* ==================================== */
        /* DROPDOWN MENU STYLY (pro navigaci) */
        /* OPRAVENO: Odstranění kolidujících mobilních stylů */
        /* ==================================== */

        .dropdown-link {
            position: relative;
            display: inline-block;
        }
        .dropbtn {
            padding: 10px 15px;
            background-color: transparent;
            color: var(--color-text-light);
            text-decoration: none;
            font-size: 1rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        .dropbtn:hover {
            color: var(--color-primary);
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: rgba(30, 30, 50, 0.95);
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);
            z-index: 1000;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 5px 0;
            backdrop-filter: blur(5px);
            top: 100%;
            left: 0;
        }
        .dropdown-content a {
            color: var(--color-text-light);
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            font-size: 0.95rem;
            transition: background-color 0.3s, color 0.3s;
        }
        .dropdown-content a:hover {
            background-color: var(--color-input-bg);
            color: var(--color-primary);
        }
        .dropdown-link:hover .dropdown-content {
            display: block;
        }
        /* Ponecháme zde jen to, co je nezbytně nutné, zbytek necháme na hlavním CSS */
        @media (max-width: 992px) {
            .dropdown-link .dropdown-content {
                position: static;
                /* display: none; -- TOTO JSME ODEBRALI, aby se menu zobrazilo uvnitř mobilního menu */
                box-shadow: none;
                border: none;
                padding: 0;
                background-color: transparent;
            }
            .dropdown-link a {
                padding-left: 30px;
            }
        }

    </style>
</head>
<body id="top">
    <div class="cyber-bg">
        <div class="cyber-gradient"></div>
        <div class="matrix-rain" id="matrixRain"></div>
    </div>
    <div class="particles" id="particlesContainer"></div>
    <div class="data-streams" id="dataStreams"></div>
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
    <div class="grid-overlay">
        <div class="grid-lines"></div>
        <div class="grid-glow"></div>
    </div>
    <div class="scanlines"></div>
    <div class="noise-overlay"></div>

    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">CZbot</a> 
            <ul class="nav-links">
                <li class="dropdown-link">
                    <a href="index.html#features" class="dropbtn">Funkce ▼</a>
                    <div class="dropdown-content">
                        <a href="crongenerator.html">CRON Generator</a>
                        <a href="embedgenerator.html">Embed Generator</a>
                        <a href="stats.html">Status bota</a>                        
                    </div>
                </li>
                
                <li><a href="commands.html">Příkazy</a></li>
                <li><a href="warns.html">Moderátorské záznamy</a></li> 
                <li><a href="https://rs422cznas.myds.me:5038/stats/">Webové statistiky serverů</a></li>
                <li><a href="https://discord.gg/hk6PdtVxbm" target="_blank">Support server</a></li>
            </ul>
            <div class="nav-bottom">
                <a href="https://discord.com/oauth2/authorize?client_id=902877191086420008&permissions=8&scope=bot%20applications.commands" class="cyber-button">Přidat na server</a>
            </div>
            <button class="mobile-menu-button" id="mobileMenuBtn">
                <div class="hamburger">
                    <span></span><span></span><span></span>
                </div>
            </button>
        </div>
    </nav>
    
    <section class="status-section">
        <div class="status-container">
            <div class="section-header">
                <h1 class="section-title">Status Systémů</h1>
                <p class="section-subtitle">Živá data o stavu CZBota, API a všech modulů (Cogs).</p>
            </div>
            
            <div id="warnBox" style="display:none;"></div>

            <div class="stats-box">
                <div class="status-grid">
                    
                    <div>
                        <h2 class="column-title">Základní Statistiky</h2>
                        <ul id="statusList" class="status-list">
                            <li>Načítám data...</li>
                        </ul>
                    </div>

                    <div>
                        <h2 class="column-title">Stav Modulů (Cogs)</h2>
                        <ul id="cogsList" class="cogs-list">
                            <li>Načítám moduly...</li>
                        </ul>
                    </div>

                </div>
            </div>
            
        </div>
    </section>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="https://github.com/papiscze/czbot" target="_blank">GitHub</a>
                <span class="footer-separator">•</span>
                <a href="https://discord.gg/hk6PdtVxbm" target="_blank">Support server</a>
                <span class="footer-separator">•</span>
                <a href="index.html#features">Funkce</a>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 CZbot. Všechna práva vyhrazena.</p>
                <p class="footer-credit">Šablona inspirována <a href="https://templatemo.com/tm-594-nexus-flow" target="_blank" rel="noopener nofollow">TemplateMo Nexus Flow</a></p>
            </div>
        </div>
    </footer>

    <script src="templatemo-nexus-scripts.js"></script> 
    <script>

        const cogs_to_load = ["Audio Streaming","Administrátorský cog","Administrátorský 2 cog","Crossban","Pokročilé plánované zprávy","Auditlogger","Automatické publikace zpráv","Automatické role","Dočasné hlasové kanály","Giveaway","Hlasování","Kolo štěstí","Lokalizace","Moderátorské příkazy","Narozeniny","Ověřování a Reakční role","Patreon","Počítání","Podcasty","Překlad","RAID ochrana","Reputace","RSS čtečka", "Zálohování serverů", "Plánované zprávy","Scam ochrana","Statistiky","Svátky","Tikety","Uvítací/odchodové zprávy","Uživatelské příkazy","Vlákna a reakce na zprávy","Vodoznaky","XP úrovně","AI cog", "Zpovědi"];

        async function fetchStatus() {
            const statusList = document.getElementById("statusList");
            const cogsList = document.getElementById("cogsList");
            const warnBox = document.getElementById("warnBox");

            // 🟠 sem napiš vlastní status zprávu (pokud nechceš žádnou, nech to prázdné)
            const warn_message = ""; 

            // zobrazení nebo skrytí varovného boxu
            if (warn_message && warn_message.trim() !== "") {
                warnBox.textContent = warn_message;
                warnBox.classList.add("warn-box");
                warnBox.style.display = "block";
            } else {
                warnBox.style.display = "none";
            }

            statusList.innerHTML="<li>Načítám data...</li>";
            cogsList.innerHTML="<li>Načítám moduly...</li>";

            // OPRAVENÁ FUNKCE addItem
            function addItem(label, value, unit="", cls=""){ 
                const li = document.createElement("li"); 
                // Zde je oprava: Používáme span tagy pro label a value s příslušnými třídami
                li.innerHTML = `<span class="label">${label}</span><span class="value ${cls}">${value} ${unit}</span>`; 
                return li;
            }

            try {
                const res = await fetch("https://rs422cznas.myds.me:5038/status");
                const data = await res.json();

                const uptime_sec = data.uptime_seconds || 0;
                
                const days = Math.floor(uptime_sec / 86400);
                const hours = Math.floor((uptime_sec % 86400) / 3600);
                const minutes = Math.floor((uptime_sec % 3600) / 60);
                const seconds = Math.floor(uptime_sec % 60);
                
                let uptime_str = '';
                if (days > 0) uptime_str += `${days}d `;
                if (hours > 0 || days > 0) uptime_str += `${hours}h `;
                uptime_str += `${minutes}m ${seconds}s`;


                statusList.innerHTML="";
                statusList.appendChild(addItem("Bot status", data.bot_status, "", data.bot_status==="online"?"status-online":"status-offline-cog"));
                statusList.appendChild(addItem("Uptime", uptime_str));
                statusList.appendChild(addItem("Počet serverů", data.guilds.toLocaleString()));
                statusList.appendChild(addItem("Počet uživatelů", data.users.toLocaleString()));
                statusList.appendChild(addItem("CPU využití", data.cpu_percent, "%"));
                statusList.appendChild(addItem("RAM využití", data.ram_mb.toFixed(2), "MB"));
                statusList.appendChild(addItem("API Status", data.api_db_status, "", data.api_db_status==="OK"?"status-ok":"status-offline-cog"));        
                statusList.appendChild(addItem("Databáze Status", data.api_db_status, "", data.api_db_status==="OK"?"status-ok":"status-offline-cog"));

                cogsList.innerHTML="";
                
                const sortedCogs = Object.entries(data.cogs).sort((a,b) => a[0].localeCompare(b[0], 'cs'));
                
                const receivedCogs = new Set(Object.keys(data.cogs));
                const allCogs = new Map(sortedCogs);

                cogs_to_load.forEach(cogName => {
                    if (!receivedCogs.has(cogName)) {
                        allCogs.set(cogName, "Nedostupné");
                    }
                });
                
                const finalSortedCogs = Array.from(allCogs).sort((a,b) => a[0].localeCompare(b[0], 'cs'));


                for(const [name,status] of finalSortedCogs){
                    let cls="";
                    let displayStatus = status;

                    if(status==="Funkční") cls="status-ok";
                    else if(status.toLowerCase().includes("error") || status.toLowerCase().includes("chyba") || status.toLowerCase().includes("nedostupné")) {
                        cls="status-err";
                        if (displayStatus === "Nedostupné") displayStatus = "Offline"; 
                    }
                    else cls="status-offline-cog";
                    
                    cogsList.appendChild(addItem(name,displayStatus,"",cls));
                }
            } catch(err){
                // Zpracování chyby při nedostupnosti API
                statusList.innerHTML="";
                statusList.appendChild(addItem("Bot status","Offline","", "status-offline-cog"));
                statusList.appendChild(addItem("Uptime","-"));
                statusList.appendChild(addItem("Počet serverů","-"));
                statusList.appendChild(addItem("Počet uživatelů","-"));
                statusList.appendChild(addItem("CPU využití","-","%"));
                statusList.appendChild(addItem("RAM využití","-","MB"));
                statusList.appendChild(addItem("API Status","Nedostupná","", "status-offline-cog"));
                statusList.appendChild(addItem("Databáze Status","Nedostupná","", "status-offline-cog"));

                cogsList.innerHTML="";
                cogs_to_load.sort((a,b) => a.localeCompare(b, 'cs')).forEach(label => {
                    cogsList.appendChild(addItem(label,"Offline","", "status-offline-cog"));
                });
            }
        }

        fetchStatus();
        // Nastavit automatické obnovování statusu každých 30 sekund
        setInterval(fetchStatus, 30000); 
    </script>
</body>
</html>