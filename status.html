<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Bota | CZbot</title>
    <link href="templatemo-nexus-style.css" rel="stylesheet">
</head>
<body id="top">
    
    <div class="cyber-bg">
        <div class="cyber-gradient"></div>
        <div class="matrix-rain" id="matrixRain"></div>
    </div>
    
    <div class="particles" id="particlesContainer"></div>
    <div class="data-streams" id="dataStreams"></div>
    
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
    
    <div class="grid-overlay">
        <div class="grid-lines"></div>
        <div class="grid-glow"></div>
    </div>
    
    <div class="scanlines"></div>
    <div class="noise-overlay"></div>
    
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">CZbot</a>
            <ul class="nav-links">
                <li><a href="commands.html">P≈ô√≠kazy</a></li>
                
                <li class="dropdown">
                    <a href="" class="dropbtn">N√°stroje<span class="arrow">‚ñº</span></a> 
                    <div class="dropdown-content">
                        <a href="crongenerator.html">Cron Generator</a>
                        <a href="embedgenerator.html">Embed Generator</a>
                        <a href="status.html" class="active-item">Status bota</a> 
                    </div>
                </li>      
                <li><a href="warns.html">Moder√°torsk√© z√°znamy</a></li>
                <li><a href="https://rs422cznas.myds.me:5038/stats/">Webov√© statistiky server≈Ø</a></li>
            </ul>
            <div class="nav-bottom">
                <a href="https://discord.com/oauth2/authorize?client_id=902877191086420008&permissions=8&scope=bot%20applications.commands" class="cyber-button">P≈ôidat bota</a>
            </div>
            <button class="mobile-menu-button" id="mobileMenuBtn">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>
    </nav>

    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <a href="index.html" class="mobile-menu-logo">CZbot</a>
            <button class="mobile-menu-close" id="mobileMenuClose">‚úï</button>
        </div>
        
        <nav class="mobile-menu-nav">
            <ul>
                <li><a href="commands.html">P≈ô√≠kazy</a></li>

                <li class="mobile-submenu-header">
                    <a href="" class="mobile-dropbtn">N√°stroje<span class="arrow">‚ñº</span></a>
                    <ul class="mobile-submenu-content">
                        <li><a href="crongenerator.html">Cron Generator</a></li>
                        <li><a href="embedgenerator.html">Embed Generator</a></li>
                        <li><a href="status.html" class="active-item">Status bota</a></li> 
                    </ul>
                </li>

                <li><a href="warns.html">Moder√°torsk√© z√°znamy</a></li>
                <li><a href="https://rs422cznas.myds.me:5038/stats/">Webov√© statistiky server≈Ø</a></li>
            </ul>
        </nav>
        
        <div class="mobile-menu-cta">
            <a href="https://discord.com/oauth2/authorize?client_id=902877191086420008&permissions=8&scope=bot%20applications.commands" class="cyber-button">P≈ôidat bota</a>
        </div>
    </div>

    <section class="command-viewer fade-up status-viewer" id="statusViewer">
        <div class="command-viewer-container status-viewer-container">
            <header class="command-header status-header">
                <h1 class="header-title">Status Syst√©m≈Ø</h1>
                <p class="header-subtitle">≈Ωiv√° data o stavu CZBota, API a v≈°ech modul≈Ø (Cogs).</p>
            </header>

            <div id="warnBox" style="display:none;" class="warn-box"></div>

            <div class="command-list-wrapper stats-box"> 
                <div class="status-grid">
                    
                    <div>
                        <h2 class="column-title">Z√°kladn√≠ Statistiky</h2>
                        <ul id="statusList" class="status-list">
                            <li>Naƒç√≠t√°m data...</li>
                        </ul>
                    </div>

                    <div>
                        <h2 class="column-title">Stav Modul≈Ø (Cogs)</h2>
                        <ul id="cogsList" class="cogs-list">
                            <li>Naƒç√≠t√°m moduly...</li>
                        </ul>
                    </div>

                </div>
            </div>

        </div>
    </section>
    
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="https://github.com/papiscze/czbot">GitHub</a>
                <span class="footer-separator">‚Ä¢</span>
                <a href="https://discord.gg/hk6PdtVxbm">Support Server</a>
                <span class="footer-separator">‚Ä¢</span>
                <a href="https://github.com/papiscze/czbot/wiki">GitHub dokumentace</a>
                <span class="footer-separator">‚Ä¢</span>
                <a href="mailto:admin@ofpmafia.eu">Kontakt</a>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 CZbot. Verze webu 1.0. V≈°echna pr√°va vyhrazena</p>
                <p class="footer-credit">≈†ablona inspirov√°na <a href="https://templatemo.com" target="_blank" rel="noopener nofollow">TemplateMo</a></p>
            </div>
        </div>
    </footer>

    <script src="templatemo-nexus-scripts.js"></script>
    
    <script>
        // Seznam modul≈Ø pro kontrolu chybƒõj√≠c√≠ch (Z≈ÆST√ÅV√Å BEZE ZMƒöNY)
        const cogs_to_load = ["Audio Streaming","Administr√°torsk√Ω cog","Administr√°torsk√Ω 2 cog","Crossban","Pokroƒçil√© pl√°novan√© zpr√°vy","Auditlogger","Automatick√© publikace zpr√°v","Automatick√© role","Doƒçasn√© hlasov√© kan√°ly","Giveaway","Hlasov√°n√≠","Kolo ≈°tƒõst√≠","Lokalizace","Moder√°torsk√© p≈ô√≠kazy","Narozeniny","Ovƒõ≈ôov√°n√≠ a Reakƒçn√≠ role","Patreon","Poƒç√≠t√°n√≠","Podcasty","P≈ôeklad","RAID ochrana","Reputace","RSS ƒçteƒçka", "Z√°lohov√°n√≠ server≈Ø", "Pl√°novan√© zpr√°vy","Scam ochrana","Statistiky","Sv√°tky","Tikety","Uv√≠tac√≠/odchodov√© zpr√°vy","U≈æivatelsk√© p≈ô√≠kazy","Vl√°kna a reakce na zpr√°vy","Vodoznaky","XP √∫rovnƒõ","AI cog", "Zpovƒõdi"];

        async function fetchStatus() {
            const statusList = document.getElementById("statusList");
            const cogsList = document.getElementById("cogsList");
            const warnBox = document.getElementById("warnBox");

            // --- LOGIKA OPRAVY PRO POSUN ---
            // 1. Ulo≈æit aktu√°ln√≠ v√Ω≈°ku p≈ôed vymaz√°n√≠m
            const statusHeight = statusList.clientHeight;
            const cogsHeight = cogsList.clientHeight;

            // 2. Nastavit minim√°ln√≠ v√Ω≈°ku k zamezen√≠ posunu
            // Pou≈æijeme pouze v p≈ô√≠padƒõ, ≈æe je v√Ω≈°ka vƒõt≈°√≠ ne≈æ 0, abychom zbyteƒçnƒõ neaplikovali min-height na pr√°zdn√Ω prvek
            if (statusHeight > 0) {
                statusList.style.minHeight = `${statusHeight}px`;
            }
            if (cogsHeight > 0) {
                cogsList.style.minHeight = `${cogsHeight}px`;
            }
            // --------------------------------

            // üü† Zde zadejte vlastn√≠ status zpr√°vu
            const warn_message = ""; 

            if (warn_message && warn_message.trim() !== "") {
                warnBox.textContent = warn_message;
                warnBox.style.display = "block";
            } else {
                warnBox.style.display = "none";
            }

            // Nyn√≠, kdy≈æ je min-height nastaven, m≈Ø≈æeme bezpeƒçnƒõ vymazat obsah:
            statusList.innerHTML="<li>Naƒç√≠t√°m data...</li>";
            cogsList.innerHTML="<li>Naƒç√≠t√°m moduly...</li>";

            function addItem(label, value, unit="", cls=""){ 
                const li = document.createElement("li"); 
                li.innerHTML = `<span class="label">${label}</span><span class="value ${cls}">${value} ${unit}</span>`; 
                return li;
            }

            try {
                const res = await fetch("https://rs422cznas.myds.me:5038/status"); 
                const data = await res.json();

                // --- V√ùPOƒåTY (Z≈ÆST√ÅVAJ√ç BEZE ZMƒöNY) ---
                const uptime_sec = data.uptime_seconds || 0;
                
                const days = Math.floor(uptime_sec / 86400);
                const hours = Math.floor((uptime_sec % 86400) / 3600);
                const minutes = Math.floor((uptime_sec % 3600) / 60);
                const seconds = Math.floor(uptime_sec % 60);
                
                let uptime_str = '';
                if (days > 0) uptime_str += `${days}d `;
                if (hours > 0 || days > 0) uptime_str += `${hours}h `;
                uptime_str += `${minutes}m ${seconds}s`;


                // --- PLNƒöN√ç SEZNAM≈Æ (Z≈ÆST√ÅV√Å BEZE ZMƒöNY) ---
                statusList.innerHTML="";
                statusList.appendChild(addItem("Bot status", data.bot_status, "", data.bot_status==="online"?"status-online":"status-offline-cog"));
                statusList.appendChild(addItem("Uptime", uptime_str));
                statusList.appendChild(addItem("Poƒçet server≈Ø", data.guilds.toLocaleString()));
                statusList.appendChild(addItem("Poƒçet u≈æivatel≈Ø", new Intl.NumberFormat('cs-CZ').format(data.users))); 
                statusList.appendChild(addItem("CPU vyu≈æit√≠", data.cpu_percent.toFixed(2), "%"));
                statusList.appendChild(addItem("RAM vyu≈æit√≠", data.ram_mb.toFixed(2), "MB"));
                statusList.appendChild(addItem("API Status", data.api_db_status, "", data.api_db_status==="OK"?"status-ok":"status-offline-cog")); ¬† ¬† ¬† ¬†
                statusList.appendChild(addItem("Datab√°ze Status", data.api_db_status, "", data.api_db_status==="OK"?"status-ok":"status-offline-cog"));

                // --- STAV MODUL≈Æ (COGS) ---
                cogsList.innerHTML="";
                
                const sortedCogs = Object.entries(data.cogs).sort((a,b) => a[0].localeCompare(b[0], 'cs'));
                const receivedCogs = new Set(Object.keys(data.cogs));
                const allCogs = new Map(sortedCogs);

                cogs_to_load.forEach(cogName => {
                    if (!receivedCogs.has(cogName)) {
                        allCogs.set(cogName, "Nedostupn√©");
                    }
                });
                
                const finalSortedCogs = Array.from(allCogs).sort((a,b) => a[0].localeCompare(b[0], 'cs'));

                for(const [name,status] of finalSortedCogs){
                    let cls="";
                    let displayStatus = status;

                    if(status==="Funkƒçn√≠") cls="status-ok";
                    else if(status.toLowerCase().includes("error") || status.toLowerCase().includes("chyba") || status.toLowerCase().includes("nedostupn√©") || status.toLowerCase() === "offline") {
                        cls="status-err";
                        if (displayStatus === "Nedostupn√©") displayStatus = "Offline"; 
                    }
                    else cls="status-offline-cog";
                    
                    cogsList.appendChild(addItem(name,displayStatus,"",cls));
                }
            } catch(err){
                // --- ZPRACOV√ÅN√ç CHYBY (Z≈ÆST√ÅV√Å BEZE ZMƒöNY) ---
                statusList.innerHTML="";
                statusList.appendChild(addItem("Bot status","Offline","", "status-offline-cog"));
                statusList.appendChild(addItem("Uptime","-"));
                statusList.appendChild(addItem("Poƒçet server≈Ø","-"));
                statusList.appendChild(addItem("Poƒçet u≈æivatel≈Ø","-"));
                statusList.appendChild(addItem("CPU vyu≈æit√≠","-","%"));
                statusList.appendChild(addItem("RAM vyu≈æit√≠","-","MB"));
                statusList.appendChild(addItem("API Status","Nedostupn√°","", "status-offline-cog"));
                statusList.appendChild(addItem("Datab√°ze Status","Nedostupn√°","", "status-offline-cog"));

                cogsList.innerHTML="";
                cogs_to_load.sort((a,b) => a.localeCompare(b, 'cs')).forEach(label => {
                    cogsList.appendChild(addItem(label,"Offline","", "status-offline-cog"));
                });
            } finally {
                // 3. Po dokonƒçen√≠ naƒç√≠t√°n√≠ (a≈• u≈æ √∫spƒõ≈°nƒõ nebo s chybou), resetovat min-height, 
                // aby se v√Ω≈°ka p≈ôizp≈Øsobila nov√©mu obsahu
                statusList.style.minHeight = '0';
                cogsList.style.minHeight = '0';
            }
        }

        fetchStatus();
        // Nastavit automatick√© obnovov√°n√≠ statusu ka≈æd√Ωch 30 sekund
        setInterval(fetchStatus, 30000);
    </script>
</body>
</html>