<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CZBOT - Embed Generátor</title>
    <link href="templatemo-nexus-style.css" rel="stylesheet">
    <style>
        /* Styl pro zobrazení stavu odesílání */
        .webhook-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none; /* Ve výchozím nastavení skryté */
            font-weight: bold;
        }
        .webhook-status.success {
            background-color: rgba(50, 205, 50, 0.2); /* Lime Green */
            color: #32cd32;
            border: 1px solid #32cd32;
        }
        .webhook-status.error {
            background-color: rgba(255, 69, 0, 0.2); /* Red Orange */
            color: #ff4500;
            border: 1px solid #ff4500;
        }
    </style>
</head>
<body id="top">
    <div class="cyber-bg">
        <div class="cyber-gradient"></div>
        <div class="matrix-rain" id="matrixRain"></div>
    </div>
    
    <div class="particles" id="particlesContainer"></div>
    
    <div class="data-streams" id="dataStreams"></div>
    
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
    <div class="orb orb3"></div>
    
    <div class="grid-overlay">
        <div class="grid-lines"></div>
        <div class="grid-glow"></div>
    </div>
    
    <div class="scanlines"></div>
    <div class="noise-overlay"></div>
    
    <!-- Navigation -->
    <div id="header-placeholder"></div> 

    <div class="content-section">
        <div class="content-container">

            <h1 class="page-title">Embed Generátor</h1>
            <p class="page-subtitle">Vytvořte si pokročilou formátovanou zprávu (Embed) pro Discord.</p>

            <div class="embed-generator-main">
                
                <div class="embed-form">
                    <h2>Vlastnosti Embedu</h2>
                    
                    <div class="form-group color-input-wrapper">
                        <label for="embedColor">Barva postranní čáry (Hex kód)</label>
                        <input type="text" id="embedColorHex" value="#7289da" placeholder="#RRGGBB" data-target="color">
                        <input type="color" id="embedColor" value="#7289da" data-target="color">
                    </div>

                    <div class="form-group">
                        <label for="embedTitle">Název (Title)</label>
                        <input type="text" id="embedTitle" placeholder="Např. Nová událost!" data-target="title">
                    </div>

                    <div class="form-group">
                        <label for="embedDescription">Popis (Description) <small>(Použijte \n pro nový řádek)</small></label>
                        <textarea id="embedDescription" placeholder="Zde uveďte text zprávy. Můžete použít Markdown." data-target="description"></textarea>
                    </div>
                    
                    <hr style="border-color: var(--primary-magenta-transparent); margin: 20px 0;">

                    <h3>Autor (Horní sekce)</h3>
                    <div class="form-group">
                        <label for="authorName">Jméno autora</label>
                        <input type="text" id="authorName" placeholder="Jméno (nepovinné)" data-target="author-name">
                    </div>
                    <div class="form-group">
                        <label for="authorIcon">URL ikony autora</label>
                        <input type="url" id="authorIcon" placeholder="https://..." data-target="author-icon">
                    </div>

                    <hr style="border-color: var(--primary-magenta-transparent); margin: 20px 0;">

                    <h3>Pole (Fields)</h3>
                    <div class="fields-container" id="fieldsContainer">
                        <p id="noFieldsMessage" style="color: var(--text-muted); text-align: center;">Zatím nemáte žádná pole.</p>
                    </div>
                    
                    <button class="cyber-button small-button add-field-btn" id="addFieldBtn">
                        Přidat nové pole
                    </button>
                    
                    <hr style="border-color: var(--primary-magenta-transparent); margin: 20px 0;">

                    <h3>Patička (Footer)</h3>
                    <div class="form-group">
                        <label for="footerText">Text patičky</label>
                        <input type="text" id="footerText" placeholder="Např. Odesláno CZbotem v 2025" data-target="footer-text">
                    </div>
                    <div class="form-group">
                        <label for="footerIcon">URL ikony patičky</label>
                        <input type="url" id="footerIcon" placeholder="https://..." data-target="footer-icon">
                    </div>

                </div>
                
                <div class="embed-preview">
                    <h2>Náhled</h2>
                    
                    <div class="discord-message-container">
                        <div class="bot-avatar" style="background-color: #2f3136; color: #dcddde; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">CZ</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="bot-name">CZbot</span>
                                <span class="timestamp">Dnes</span>
                            </div>
                            
                            <div class="embed-wrapper">
                                <div class="embed-color-bar" id="previewColorBar"></div>
                                <div class="embed-content">
                                    
                                    <div class="embed-author" id="previewAuthor" style="display: none;">
                                        <img class="embed-author-icon" id="previewAuthorIcon" src="" alt="Author Icon">
                                        <span id="previewAuthorName"></span>
                                    </div>
                                    
                                    <div class="embed-title" id="previewTitle" style="display: none;"></div>
                                    
                                    <div class="embed-description" id="previewDescription" style="display: none;"></div>
                                    
                                    <div class="embed-fields" id="previewFields">
                                        </div>

                                    <div class="embed-footer" id="previewFooter" style="display: none;">
                                        <img class="embed-footer-icon" id="previewFooterIcon" src="" alt="Footer Icon">
                                        <span id="previewFooterText"></span>
                                    </div>

                                </div>
                            </div>
                            </div>
                    </div>
                    </div>
            </div>

            <div class="json-output-box">
                <h3>Odeslat na Discord</h3>
                <div class="form-group">
                    <label for="webhookUrl">Discord WebHook URL</label>
                    <input type="url" id="webhookUrl" placeholder="Vložte sem URL vašeho WebHooku (https://discord.com/api/webhooks/...)">
                </div>
                <button class="cyber-button full-width-button" id="sendWebhookBtn" disabled>
                    Odeslat Embed Zprávu
                </button>
                <div id="webhookStatus" class="webhook-status" style="display: none;"></div>
            </div>

        </div>
    </div>

<!--Footer-->
    <div id="footer-placeholder"></div>

    <script>
        // -----------------------------------------------------
        // 1. LOGIKA NAVIGACE (Zůstává beze změny)
        // -----------------------------------------------------
        
        function initNavigation() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuClose = document.getElementById('mobileMenuClose');
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            
            if (mobileMenuBtn && mobileMenuOverlay && mobileMenu && mobileMenuClose) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.add('active');
                    mobileMenuOverlay.classList.add('active');
                });

                const closeMenu = () => {
                    mobileMenu.classList.remove('active');
                    mobileMenuOverlay.classList.remove('active');
                };

                mobileMenuClose.addEventListener('click', closeMenu);
                mobileMenuOverlay.addEventListener('click', closeMenu);
            }

            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    const parentLi = toggle.closest('li.dropdown');
                    if (parentLi) {
                        parentLi.classList.toggle('open'); 
                        
                        dropdownToggles.forEach(otherToggle => {
                            if (otherToggle !== toggle) {
                                otherToggle.closest('li.dropdown').classList.remove('open');
                            }
                        });
                    }
                });
            });
        }

        // -----------------------------------------------------
        // 2. LOGIKA EMBED GENERÁTORU A ODESÍLÁNÍ
        // -----------------------------------------------------

        let currentEmbedObject = {}; // Globální proměnná pro uchování aktuálního JSONu

        function initEmbedGenerator() {
            const formElements = document.querySelectorAll('[data-target]');
            const fieldsContainer = document.getElementById('fieldsContainer');
            const addFieldBtn = document.getElementById('addFieldBtn');
            const noFieldsMessage = document.getElementById('noFieldsMessage');
            
            const webhookUrlInput = document.getElementById('webhookUrl');
            const sendWebhookBtn = document.getElementById('sendWebhookBtn');
            const webhookStatus = document.getElementById('webhookStatus');

            let fieldCount = 0; 

            // --- Náhledové elementy ---
            const previewColorBar = document.getElementById('previewColorBar');
            const previewAuthor = document.getElementById('previewAuthor');
            const previewAuthorName = document.getElementById('previewAuthorName');
            const previewAuthorIcon = document.getElementById('previewAuthorIcon');
            const previewTitle = document.getElementById('previewTitle');
            const previewDescription = document.getElementById('previewDescription');
            const previewFields = document.getElementById('previewFields');
            const previewFooter = document.getElementById('previewFooter');
            const previewFooterText = document.getElementById('previewFooterText');
            const previewFooterIcon = document.getElementById('previewFooterIcon');

            function hexToDecimal(hex) {
                if (!hex || hex.length < 7) return 0;
                return parseInt(hex.replace('#', ''), 16);
            }
            
            function setIcon(imgElement, url) {
                if (url) {
                    imgElement.src = url;
                    imgElement.style.display = 'block';
                    imgElement.onerror = () => { imgElement.style.display = 'none'; };
                } else {
                    imgElement.src = ''; 
                    imgElement.style.display = 'none';
                }
            }


            function updateEmbed() {
                const hexColor = document.getElementById('embedColorHex').value || '#7289da';
                const title = document.getElementById('embedTitle').value;
                let description = document.getElementById('embedDescription').value;
                const authorName = document.getElementById('authorName').value;
                const authorIcon = document.getElementById('authorIcon').value;
                const footerText = document.getElementById('footerText').value;
                const footerIcon = document.getElementById('footerIcon').value;

                // --- 1. Aktualizace Náhledu ---

                previewColorBar.style.backgroundColor = hexColor;

                if (title) {
                    previewTitle.textContent = title;
                    previewTitle.style.display = 'block';
                } else {
                    previewTitle.style.display = 'none';
                }

                if (description) {
                    previewDescription.innerHTML = description.replace(/\\n/g, '<br>');
                    previewDescription.style.display = 'block';
                } else {
                    previewDescription.style.display = 'none';
                }

                if (authorName) {
                    previewAuthorName.textContent = authorName;
                    previewAuthor.style.display = 'flex';
                } else {
                    previewAuthor.style.display = 'none';
                }
                setIcon(previewAuthorIcon, authorIcon);
                
                if (footerText) {
                    previewFooterText.textContent = footerText;
                    previewFooter.style.display = 'flex';
                } else {
                    previewFooter.style.display = 'none';
                }
                setIcon(previewFooterIcon, footerIcon);
                
                // --- Pole (Fields) ---
                const fieldInputs = fieldsContainer.querySelectorAll('.field-item');
                previewFields.innerHTML = ''; 
                const jsonFields = [];

                fieldInputs.forEach(item => {
                    const name = item.querySelector('.field-name-input').value;
                    const value = item.querySelector('.field-value-input').value;
                    const isInline = item.querySelector('.field-inline-input').checked;

                    if (name && value) {
                        // Přidání do Náhledu
                        const fieldDiv = document.createElement('div');
                        fieldDiv.className = 'embed-field';
                        if (isInline) {
                            fieldDiv.classList.add('inline');
                        } 

                        fieldDiv.innerHTML = `
                            <div class="embed-field-name">${name}</div>
                            <div class="embed-field-value">${value.replace(/\\n/g, '<br>')}</div>
                        `;
                        previewFields.appendChild(fieldDiv);

                        // Přidání do JSON
                        jsonFields.push({
                            name: name,
                            value: value,
                            inline: isInline
                        });
                    }
                });


                // --- 2. Generování JSON pro WebHook ---
                
                const embedObject = {};

                if (hexColor && hexColor.length === 7) {
                    embedObject.color = hexToDecimal(hexColor);
                }

                if (title) {
                    embedObject.title = title;
                }

                if (description) {
                    embedObject.description = description;
                }

                if (authorName) {
                    embedObject.author = {
                        name: authorName
                    };
                    if (authorIcon) {
                        embedObject.author.icon_url = authorIcon;
                    }
                }

                if (jsonFields.length > 0) {
                    embedObject.fields = jsonFields;
                }

                if (footerText) {
                    embedObject.footer = {
                        text: footerText
                    };
                    if (footerIcon) {
                        embedObject.footer.icon_url = footerIcon;
                    }
                }

                // Finální datový objekt pro WebHook
                if (Object.keys(embedObject).length > 0) {
                    currentEmbedObject = { embeds: [embedObject] };
                } else {
                    currentEmbedObject = {};
                }
                
                // Povolení tlačítka Odeslat, pokud existuje obsah embedu
                if (Object.keys(embedObject).length > 0 && webhookUrlInput.value) {
                    sendWebhookBtn.disabled = false;
                } else {
                    sendWebhookBtn.disabled = true;
                }
            }
            
            function addField() {
                fieldCount++;
                noFieldsMessage.style.display = 'none';

                const fieldItem = document.createElement('div');
                fieldItem.className = 'field-item';
                fieldItem.dataset.id = fieldCount;

                fieldItem.innerHTML = `
                    <div class="field-row">
                        <div class="form-group">
                            <label>Název pole</label>
                            <input type="text" class="field-name-input" placeholder="Název" value="" data-target="field">
                        </div>
                        <div class="form-group">
                            <label>Hodnota pole <small>(\n pro nový řádek)</small></label>
                            <input type="text" class="field-value-input" placeholder="Hodnota" value="" data-target="field">
                        </div>
                    </div>
                    <div class="field-controls">
                        <label style="margin-right: 15px;">
                            <input type="checkbox" class="field-inline-input" checked data-target="field">
                            Zobrazit vedle sebe (Inline)
                        </label>
                        <button class="remove-field-btn cyber-button small-button">Smazat</button>
                    </div>
                `;

                fieldsContainer.appendChild(fieldItem);
                
                // Přidání posluchačů pro nové pole
                fieldItem.querySelector('.field-name-input').addEventListener('input', updateEmbed);
                fieldItem.querySelector('.field-value-input').addEventListener('input', updateEmbed);
                fieldItem.querySelector('.field-inline-input').addEventListener('change', updateEmbed);
                fieldItem.querySelector('.remove-field-btn').addEventListener('click', (e) => {
                    e.preventDefault(); 
                    fieldItem.remove();
                    if (fieldsContainer.children.length === 1) { 
                        noFieldsMessage.style.display = 'block';
                    }
                    updateEmbed();
                });

                updateEmbed();
            }
            
            // --- Odeslání zprávy přes WebHook ---
            async function sendWebhookMessage() {
                const url = webhookUrlInput.value;

                if (!url || Object.keys(currentEmbedObject).length === 0) {
                    displayStatus('Vyplňte WebHook URL a alespoň Název, Popis nebo Autor.', 'error');
                    return;
                }
                
                displayStatus('Odesílám...', 'success');
                sendWebhookBtn.disabled = true;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(currentEmbedObject)
                    });

                    if (response.ok) {
                        displayStatus('Zpráva úspěšně odeslána!', 'success');
                    } else {
                        const errorText = await response.text();
                        displayStatus(`Chyba (${response.status}): ${errorText.substring(0, 80)}...`, 'error');
                    }
                } catch (error) {
                    displayStatus('Chyba při odesílání: WebHook URL je pravděpodobně neplatná nebo kódování.', 'error');
                } finally {
                    sendWebhookBtn.disabled = false;
                }
            }

            // Funkce pro zobrazení stavu
            function displayStatus(message, type) {
                webhookStatus.textContent = message;
                webhookStatus.className = `webhook-status ${type}`;
                webhookStatus.style.display = 'block';
            }


            // --- Posluchači Událostí ---
            
            formElements.forEach(input => {
                input.addEventListener('input', updateEmbed);
            });
            
            // Synchronizace color pickeru a hex textu
            document.getElementById('embedColor').addEventListener('input', function() {
                document.getElementById('embedColorHex').value = this.value;
                updateEmbed();
            });
            document.getElementById('embedColorHex').addEventListener('input', function() {
                const hexValue = this.value.startsWith('#') ? this.value : '#' + this.value;
                if (hexValue.length >= 7) {
                    document.getElementById('embedColor').value = hexValue.substring(0, 7);
                }
                updateEmbed();
            });

            // Kontrola URL pro povolení tlačítka
            webhookUrlInput.addEventListener('input', updateEmbed);

            // Tlačítko pro přidání pole
            addFieldBtn.addEventListener('click', addField);

            // Tlačítko pro odeslání WebHooku
            sendWebhookBtn.addEventListener('click', sendWebhookMessage);


            // Přidání prvního pole při startu
            if (fieldsContainer.children.length <= 1) { 
                addField();
            }
        }


        // Spustíme obě inicializační funkce při načtení stránky
        document.addEventListener('DOMContentLoaded', () => {
            initNavigation();
            initEmbedGenerator();
        });
    </script>

</body>
</html>